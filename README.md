# Quote Tickers Server/Client

Учебная интерактивная система сервер-клиент трансляции данных о котировке
тикеров.

Создано в рамках курса "Rust для действующих разработчиков" (Яндекс Практикум),
2026 год.

## Структура проекта

Рабочее пространство (`workspace`) объединяет 4 ящика: 2 запускаемых приложения
и две библиотеки:

- `quote_server` (компилируемое имя `qserver`) — консольный TCP/UDP-сервер,
  который умеет безостановочно генерировать котировки тикеров и транслирует их
  через протокол UDP подписавшемуся клиенту
- `quote_client` (компилируемое имя `qclient`) — консольный TCP/UDP-клиент,
  получающий данные от сервера котировок
- `commons` — библиотека общих и вспомогательных методов для основных
  приложений
- `macros` — универсальные макросы, в первую очередь derive

## Установка

Требуется установленный Rust Toolchain (Rust и Cargo, версия 1.90+).
[Инструкция](https://rust-lang.org/tools/install/).

Так как все компоненты приложения объединены в рабочее пространство, возможны
одновременная компиляция, и сборка по-отдельности каждого ящика. Рекомендуется
первый вариант.

```shell
git clone git@github.com:Shindler7/rust2sprint.git
cd rust2sprint
cargo build --release
```

Запускаемые файлы и библиотеки будут размещены в директориии `target\release\`.

## Быстрый старт

### Запуск сервера

- Создайте файл `tickers.txt` и поместите его в директорию `data` в корне
  проекта (эти параметры можно изменить в настройках приложения, в файле
  `config.rs`). Примерное содержимое файла (названия тикеров):

```text
AAPL
MSFT
GOOGL
AMZN
NVDA
META
TSLA
JPM
JNJ
V
...
```

- Запустите сервер:

```shell
./qserver -p 8080
```

Ключ `-p` (`--port`) необязательный. По умолчанию используется значение `8888`.

Пока сервер работает, он будет постоянно генерировать поток тикеров, независимо
от количества подключенных клиентов.

**Важно!** При обращении через клиента нужно учитывать, что после рукопожатия
сервер отправляет информационные сообщения (например, об имеющихся командах).
Завершается этот блок терминатором `READY` после которого сервер переходит
в режим слушателя. Примерно так:

```shell
Успешное подключение к Quote Server!

READY
```

### Запуск клиента

- Создайте файл, например, `subscribes.txt` в любой доступной для чтения
  директории. В нём должны содержаться названия тикеров, обновления которых
  будут отслеживаться _(если файла нет, то отслеживаются все тикеры)_.
- Запустите клиент:

```shell
./qclient --udp 34254 stream -f ~/source/repos/subsribes.txt
```

- Можно подписаться на все тикеры, известные генератору. Запустить так:

```shell
./qclient --udp 34254 stream
```

При запуске клиента можно также передать свой адрес сокета сервера
(по умолчанию `127.0.0.1`) и порт (по умолчанию `8888`). Чтобы посмотреть
доступные команды можно вызвать `--help`:

```shell
./qclient --help
```

Подробнее о нужной команде, например, `stream`:

```shell
./qclient stream -h
```

## Основные элементы

### Генератор тикеров

Для работы генератора тикеров требуется файл с названиями, остальные данные
формируются случайным образом, но в заданном настройками (`config.rs`)
диапазоне.

Пример создания генератора и его использования:

```rust
use crate::generator::QuoteGenerator;

fn main() {
    let quote_gen = QuoteGenerator::new();
    let one = quote_gen.next_gen();
    let two = quote_gen.next_gen();

    println!("{} and {}", one, two);
}
```

### Модель `StockQuote`

Каждый тикер представлен в структуре `StockQuote`, поддерживающей сериализацию
в JSON, а также преобразование в (из) текстовый формат.

```rust
pub enum Transaction {
    Sell,
    Buy,
}

pub struct StockQuote {
    pub ticker: String,
    pub price: f64,
    pub volume: u32,
    pub timestamp: u64,
    pub transaction: Transaction,
}
```

### Клиент-серверная инфраструктура

Сервер (`qserver`) после инициализации работает в постоянном режиме, и открыт
для подключений через прослушиваемый порт. При получении валидной команды
устанавливает UDP-соединение с клиентом и транслирует данные по заданным
параметрам.

Клиент с определённым конфигурацией интервалом отправляет в параллельном потоке
серверу `ping`, подтверждая свой активный статус.

Трансляция тикеров производится при помощи 
[crossbeam-channel](https://docs.rs/crossbeam-channel/latest/crossbeam_channel/).
Диспетчер читает данные из генератора, а для каждого клиента (подписчика)
создаётся свой читатель (`Receiver`), через которого данные транслируются. 

При получении тикеров клиент десериализует их в структуру `StockQuote`.

## Документация

Все методы документированы в пределах разумной достаточности. Это можно
использовать для формирования документации стандартными методами `cargo doc`.

Например, так (из корня проекта или в каталоге отдельных крейтов):

```shell
cargo doc --open --message-format human --color auto --no-deps
```

## Тесты

Основной функционал приложения покрыт тестами.

```shell
cargo test
```

Можно запускать с флагами для подробностей:

```shell
cargo test -- --nocapture
```

## История версий

### Версии компонентов workspace

| Компонент    | Версия | Описание                                |
|--------------|--------|-----------------------------------------|
| quote_server | 0.1.2  | Сервер тикеров                          |
| quote_client | 0.1.1  | Клиент получения тикеров                |
| macros       | 0.1.0  | Библиотека макросов                     | 
| commons      | 0.1.2  | Поддерживающая библиотека общих методов |

### [quote_server]

#### 0.1.2 (04.02.2026)

- исправлена ошибка трансляции тикеров по заданной выборке: ошибка применения
  `return` вместо `continue` в методе UDP-трансляции.

#### 0.1.1 (03.02.2026)

- исправлена ошибка с паникой генератора в параллельном потоке, которая не
  влияла на основной;
- реализован диспетчер трансляций, который получает данные из канала, и
  тиражирует клиентам;
- улучшена обработка `STEAM ALL`: теперь передаётся для трансляции пустой
  `HashSet`, что означает автоматический пропуск каждого тикера из генератора
  вместо предыдущего поведения, когда `HashSet` содержал весь набор и по нему
  каждый раз делалась проверочная проходка;
- данные по UDP теперь отправляются в json-формате, что упрощает их обработку
  на клиентской стороне;
- точеный рефакторинг и улучшение кода.

### [quote_client]

#### 0.1.1 (03.02.2026)

- добавлена десериализация данных из `json` в структуру `StockQuote`;
- вывод полученных данных в консоль заменён на логирование;
- точечный рефакторинг и улучшение кода.

### [commons]

#### 0.1.2 (04.02.2026)

- изменено поведение логирования: файлы теперь дополняются, а не
  перезаписываются.

#### 0.1.1 (03.02.2026)

- улучшена обработка ошибок.

## Благодарности

Команде "Яндекс Практикум" и персонально автору ревью.
